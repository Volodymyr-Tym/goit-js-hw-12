{"version":3,"file":"gallery-load-more.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport SimpleLightbox from 'simplelightbox';\nimport { createGalleryImageTemplate } from './js/render-functions';\nimport { fetchImages } from './js/pixabay-api';\n\nconst form = document.querySelector('form.js-form');\nconst gallery = document.querySelector('ul.js-gallery');\nconst preLoader = document.querySelector('span.js-loader');\nconst loadMoreBtn = document.querySelector('.load-more-js');\n\nlet currentPage = 1;\nlet totalPages = 0;\nlet inputValue = '';\nlet galleryImageHeight = 0;\n\nconst newGalleryBox = new SimpleLightbox('ul.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nconst onFormSubmit = async event => {\n  try {\n    event.preventDefault();\n    gallery.innerHTML = '';\n    loadMoreBtn.classList.add('is-hidden');\n    preLoader.classList.remove('is-hidden');\n\n    inputValue = form.search.value.trim();\n    currentPage = 1;\n\n    if (inputValue === '') {\n      iziToast.info({\n        message: 'Searching field is empty',\n        messageSize: '16',\n        position: 'topRight',\n      });\n\n      preLoader.classList.add('is-hidden');\n      event.target.reset();\n      return;\n    }\n\n    const { data } = await fetchImages(inputValue, currentPage);\n    totalPages = Math.ceil(data.totalHits / 15);\n\n    if (data.hits.length === 0) {\n      iziToast.error({\n        title: 'Sorry,',\n        message:\n          'there are no images matching your search query. Please try again!',\n        messageSize: '16',\n        position: 'topRight',\n      });\n\n      event.target.reset();\n      return;\n    }\n\n    const drawGallery = data.hits\n      .map(imageInfo => createGalleryImageTemplate(imageInfo))\n      .join('');\n\n    gallery.insertAdjacentHTML('beforeend', drawGallery);\n\n    const galleryImage = gallery.querySelector('li');\n    galleryImageHeight = galleryImage.getBoundingClientRect().height;\n\n    if (totalPages > 1) {\n      loadMoreBtn.classList.remove('is-hidden');\n    }\n\n    newGalleryBox.refresh();\n    event.target.reset();\n  } catch ({ response: err }) {\n    iziToast.error({\n      title: 'Ooops',\n      titleSize: '18',\n      message: err.data,\n      messageSize: '18',\n      position: 'center',\n      timeout: false,\n      progressBar: false,\n      overlay: true,\n      overlayColor: 'rgba(0, 0, 0, 0.5)',\n    });\n  } finally {\n    preLoader.classList.add('is-hidden');\n  }\n};\n\nconst onLoadMoreBtnClick = async event => {\n  preLoader.classList.remove('is-hidden');\n\n  try {\n    currentPage++;\n\n    const { data } = await fetchImages(inputValue, currentPage);\n\n    const drawGallery = data.hits\n      .map(imageInfo => createGalleryImageTemplate(imageInfo))\n      .join('');\n\n    gallery.insertAdjacentHTML('beforeend', drawGallery);\n    newGalleryBox.refresh();\n\n    scrollBy({ top: galleryImageHeight * 2, behavior: 'smooth' });\n\n    if (currentPage === totalPages) {\n      loadMoreBtn.classList.add('is-hidden');\n      iziToast.info({\n        message: `We're sorry, but you've reached the end of search results.`,\n        messageSize: '16',\n        position: 'topRight',\n        timeout: false,\n      });\n      return;\n    }\n  } catch ({ response: err }) {\n    iziToast.error({\n      title: 'Ooops',\n      titleSize: '18',\n      message: err.data,\n      messageSize: '18',\n      position: 'center',\n      timeout: false,\n      progressBar: false,\n      overlay: true,\n      overlayColor: 'rgba(0, 0, 0, 0.5)',\n    });\n  } finally {\n    preLoader.classList.add('is-hidden');\n  }\n};\n\nform.addEventListener('submit', onFormSubmit);\nloadMoreBtn.addEventListener('click', onLoadMoreBtnClick);\n"],"names":["form","gallery","preLoader","loadMoreBtn","currentPage","totalPages","inputValue","galleryImageHeight","newGalleryBox","SimpleLightbox","onFormSubmit","event","iziToast","data","fetchImages","drawGallery","imageInfo","createGalleryImageTemplate","err","onLoadMoreBtnClick"],"mappings":"uJAKA,MAAMA,EAAO,SAAS,cAAc,cAAc,EAC5CC,EAAU,SAAS,cAAc,eAAe,EAChDC,EAAY,SAAS,cAAc,gBAAgB,EACnDC,EAAc,SAAS,cAAc,eAAe,EAE1D,IAAIC,EAAc,EACdC,EAAa,EACbC,EAAa,GACbC,EAAqB,EAEzB,MAAMC,EAAgB,IAAIC,EAAe,eAAgB,CACvD,aAAc,MACd,aAAc,GAChB,CAAC,EAEKC,EAAe,MAAMC,GAAS,CAClC,GAAI,CASF,GARAA,EAAM,eAAc,EACpBV,EAAQ,UAAY,GACpBE,EAAY,UAAU,IAAI,WAAW,EACrCD,EAAU,UAAU,OAAO,WAAW,EAEtCI,EAAaN,EAAK,OAAO,MAAM,KAAI,EACnCI,EAAc,EAEVE,IAAe,GAAI,CACrBM,EAAS,KAAK,CACZ,QAAS,2BACT,YAAa,KACb,SAAU,UAClB,CAAO,EAEDV,EAAU,UAAU,IAAI,WAAW,EACnCS,EAAM,OAAO,QACb,MACD,CAED,KAAM,CAAE,KAAAE,CAAI,EAAK,MAAMC,EAAYR,EAAYF,CAAW,EAG1D,GAFAC,EAAa,KAAK,KAAKQ,EAAK,UAAY,EAAE,EAEtCA,EAAK,KAAK,SAAW,EAAG,CAC1BD,EAAS,MAAM,CACb,MAAO,SACP,QACE,oEACF,YAAa,KACb,SAAU,UAClB,CAAO,EAEDD,EAAM,OAAO,QACb,MACD,CAED,MAAMI,EAAcF,EAAK,KACtB,IAAIG,GAAaC,EAA2BD,CAAS,CAAC,EACtD,KAAK,EAAE,EAEVf,EAAQ,mBAAmB,YAAac,CAAW,EAGnDR,EADqBN,EAAQ,cAAc,IAAI,EACb,sBAAuB,EAAC,OAEtDI,EAAa,GACfF,EAAY,UAAU,OAAO,WAAW,EAG1CK,EAAc,QAAO,EACrBG,EAAM,OAAO,OACjB,OAAW,CAAE,SAAUO,GAAO,CAC1BN,EAAS,MAAM,CACb,MAAO,QACP,UAAW,KACX,QAASM,EAAI,KACb,YAAa,KACb,SAAU,SACV,QAAS,GACT,YAAa,GACb,QAAS,GACT,aAAc,oBACpB,CAAK,CACL,QAAY,CACRhB,EAAU,UAAU,IAAI,WAAW,CACpC,CACH,EAEMiB,EAAqB,MAAMR,GAAS,CACxCT,EAAU,UAAU,OAAO,WAAW,EAEtC,GAAI,CACFE,IAEA,KAAM,CAAE,KAAAS,CAAI,EAAK,MAAMC,EAAYR,EAAYF,CAAW,EAEpDW,EAAcF,EAAK,KACtB,IAAIG,GAAaC,EAA2BD,CAAS,CAAC,EACtD,KAAK,EAAE,EAOV,GALAf,EAAQ,mBAAmB,YAAac,CAAW,EACnDP,EAAc,QAAO,EAErB,SAAS,CAAE,IAAKD,EAAqB,EAAG,SAAU,QAAQ,CAAE,EAExDH,IAAgBC,EAAY,CAC9BF,EAAY,UAAU,IAAI,WAAW,EACrCS,EAAS,KAAK,CACZ,QAAS,6DACT,YAAa,KACb,SAAU,WACV,QAAS,EACjB,CAAO,EACD,MACD,CACL,OAAW,CAAE,SAAUM,GAAO,CAC1BN,EAAS,MAAM,CACb,MAAO,QACP,UAAW,KACX,QAASM,EAAI,KACb,YAAa,KACb,SAAU,SACV,QAAS,GACT,YAAa,GACb,QAAS,GACT,aAAc,oBACpB,CAAK,CACL,QAAY,CACRhB,EAAU,UAAU,IAAI,WAAW,CACpC,CACH,EAEAF,EAAK,iBAAiB,SAAUU,CAAY,EAC5CP,EAAY,iBAAiB,QAASgB,CAAkB"}