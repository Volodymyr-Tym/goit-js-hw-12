{"version":3,"file":"gallery-infinite-scroll.js","sources":["../src/js/gallery-infinite-scroll.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport SimpleLightbox from 'simplelightbox';\nimport { createGalleryImageTemplate } from './render-functions';\nimport { fetchImages } from './pixabay-api';\n\nconst form = document.querySelector('form.js-form');\nconst gallery = document.querySelector('ul.js-gallery');\nconst preLoader = document.querySelector('span.js-loader');\nconst observedEl = document.querySelector('.observed-el-js');\n\nlet currentPage = 1;\nlet totalPages = 0;\nlet inputValue = '';\n\nconst newGalleryBox = new SimpleLightbox('ul.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nconst observerOptions = {\n  root: null,\n  rootMargin: '0px 0px 200px 0px',\n  treshhold: 1,\n};\nconst observerCallBack = async entries => {\n  if (entries[0].isIntersecting) {\n    preLoader.classList.remove('is-hidden');\n    console.log(entries);\n    try {\n      currentPage++;\n\n      const { data } = await fetchImages(inputValue, currentPage);\n\n      const drawGallery = data.hits\n        .map(imageInfo => createGalleryImageTemplate(imageInfo))\n        .join('');\n\n      gallery.insertAdjacentHTML('beforeend', drawGallery);\n      newGalleryBox.refresh();\n\n      if (currentPage === totalPages) {\n        observer.disconnect();\n        iziToast.info({\n          message: `We're sorry, but you've reached the end of search results.`,\n          messageSize: '16',\n          position: 'topRight',\n          timeout: false,\n        });\n        currentPage = 1;\n        return;\n      }\n    } catch ({ response: err }) {\n      iziToast.error({\n        title: 'Ooops',\n        titleSize: '18',\n        message: err.data,\n        messageSize: '18',\n        position: 'center',\n        timeout: false,\n        progressBar: false,\n        overlay: true,\n        overlayColor: 'rgba(0, 0, 0, 0.5)',\n      });\n    } finally {\n      preLoader.classList.add('is-hidden');\n    }\n  }\n};\n\nconst observer = new IntersectionObserver(observerCallBack, observerOptions);\n\nconst onFormSubmit = async event => {\n  try {\n    event.preventDefault();\n    gallery.innerHTML = '';\n    preLoader.classList.remove('is-hidden');\n\n    inputValue = form.search.value.trim();\n    currentPage = 1;\n\n    if (inputValue === '') {\n      iziToast.info({\n        message: 'Searching field is empty',\n        messageSize: '16',\n        position: 'topRight',\n      });\n\n      preLoader.classList.add('is-hidden');\n      event.target.reset();\n      return;\n    }\n\n    const { data } = await fetchImages(inputValue, currentPage);\n    totalPages = Math.ceil(data.totalHits / 15);\n\n    if (data.hits.length === 0) {\n      iziToast.error({\n        title: 'Sorry,',\n        message:\n          'there are no images matching your search query. Please try again!',\n        messageSize: '16',\n        position: 'topRight',\n      });\n\n      event.target.reset();\n      return;\n    }\n\n    const drawGallery = data.hits\n      .map(imageInfo => createGalleryImageTemplate(imageInfo))\n      .join('');\n\n    gallery.insertAdjacentHTML('beforeend', drawGallery);\n\n    if (totalPages > 1) {\n      observer.observe(observedEl);\n    } else {\n      observer.disconnect();\n    }\n\n    newGalleryBox.refresh();\n    event.target.reset();\n  } catch ({ response: err }) {\n    iziToast.error({\n      title: 'Ooops',\n      titleSize: '18',\n      message: err.data,\n      messageSize: '18',\n      position: 'center',\n      timeout: false,\n      progressBar: false,\n      overlay: true,\n      overlayColor: 'rgba(0, 0, 0, 0.5)',\n    });\n  } finally {\n    preLoader.classList.add('is-hidden');\n  }\n};\n\nform.addEventListener('submit', onFormSubmit);\n"],"names":["form","gallery","preLoader","observedEl","currentPage","totalPages","inputValue","newGalleryBox","SimpleLightbox","observerOptions","observerCallBack","entries","data","fetchImages","drawGallery","imageInfo","createGalleryImageTemplate","observer","iziToast","err","onFormSubmit","event"],"mappings":"uJAKA,MAAMA,EAAO,SAAS,cAAc,cAAc,EAC5CC,EAAU,SAAS,cAAc,eAAe,EAChDC,EAAY,SAAS,cAAc,gBAAgB,EACnDC,EAAa,SAAS,cAAc,iBAAiB,EAE3D,IAAIC,EAAc,EACdC,EAAa,EACbC,EAAa,GAEjB,MAAMC,EAAgB,IAAIC,EAAe,eAAgB,CACvD,aAAc,MACd,aAAc,GAChB,CAAC,EAEKC,EAAkB,CACtB,KAAM,KACN,WAAY,oBACZ,UAAW,CACb,EACMC,EAAmB,MAAMC,GAAW,CACxC,GAAIA,EAAQ,CAAC,EAAE,eAAgB,CAC7BT,EAAU,UAAU,OAAO,WAAW,EACtC,QAAQ,IAAIS,CAAO,EACnB,GAAI,CACFP,IAEA,KAAM,CAAE,KAAAQ,CAAI,EAAK,MAAMC,EAAYP,EAAYF,CAAW,EAEpDU,EAAcF,EAAK,KACtB,IAAIG,GAAaC,EAA2BD,CAAS,CAAC,EACtD,KAAK,EAAE,EAKV,GAHAd,EAAQ,mBAAmB,YAAaa,CAAW,EACnDP,EAAc,QAAO,EAEjBH,IAAgBC,EAAY,CAC9BY,EAAS,WAAU,EACnBC,EAAS,KAAK,CACZ,QAAS,6DACT,YAAa,KACb,SAAU,WACV,QAAS,EACnB,CAAS,EACDd,EAAc,EACd,MACD,CACP,OAAa,CAAE,SAAUe,GAAO,CAC1BD,EAAS,MAAM,CACb,MAAO,QACP,UAAW,KACX,QAASC,EAAI,KACb,YAAa,KACb,SAAU,SACV,QAAS,GACT,YAAa,GACb,QAAS,GACT,aAAc,oBACtB,CAAO,CACP,QAAc,CACRjB,EAAU,UAAU,IAAI,WAAW,CACpC,CACF,CACH,EAEMe,EAAW,IAAI,qBAAqBP,EAAkBD,CAAe,EAErEW,EAAe,MAAMC,GAAS,CAClC,GAAI,CAQF,GAPAA,EAAM,eAAc,EACpBpB,EAAQ,UAAY,GACpBC,EAAU,UAAU,OAAO,WAAW,EAEtCI,EAAaN,EAAK,OAAO,MAAM,KAAI,EACnCI,EAAc,EAEVE,IAAe,GAAI,CACrBY,EAAS,KAAK,CACZ,QAAS,2BACT,YAAa,KACb,SAAU,UAClB,CAAO,EAEDhB,EAAU,UAAU,IAAI,WAAW,EACnCmB,EAAM,OAAO,QACb,MACD,CAED,KAAM,CAAE,KAAAT,CAAI,EAAK,MAAMC,EAAYP,EAAYF,CAAW,EAG1D,GAFAC,EAAa,KAAK,KAAKO,EAAK,UAAY,EAAE,EAEtCA,EAAK,KAAK,SAAW,EAAG,CAC1BM,EAAS,MAAM,CACb,MAAO,SACP,QACE,oEACF,YAAa,KACb,SAAU,UAClB,CAAO,EAEDG,EAAM,OAAO,QACb,MACD,CAED,MAAMP,EAAcF,EAAK,KACtB,IAAIG,GAAaC,EAA2BD,CAAS,CAAC,EACtD,KAAK,EAAE,EAEVd,EAAQ,mBAAmB,YAAaa,CAAW,EAE/CT,EAAa,EACfY,EAAS,QAAQd,CAAU,EAE3Bc,EAAS,WAAU,EAGrBV,EAAc,QAAO,EACrBc,EAAM,OAAO,OACjB,OAAW,CAAE,SAAUF,GAAO,CAC1BD,EAAS,MAAM,CACb,MAAO,QACP,UAAW,KACX,QAASC,EAAI,KACb,YAAa,KACb,SAAU,SACV,QAAS,GACT,YAAa,GACb,QAAS,GACT,aAAc,oBACpB,CAAK,CACL,QAAY,CACRjB,EAAU,UAAU,IAAI,WAAW,CACpC,CACH,EAEAF,EAAK,iBAAiB,SAAUoB,CAAY"}